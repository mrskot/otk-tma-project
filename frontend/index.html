<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TMA-ERP: –ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–æ–º</title>
    
    <!-- –í–ê–ñ–ù–û: –ù–û–í–ê–Ø –í–ï–†–°–ò–Ø –î–õ–Ø –°–ë–†–û–°–ê –ö–≠–®–ê -->
    <link rel="stylesheet" href="styles.css?v=20251127_07"> 
    
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="app.js?v=20251127_07"></script>
</head>
<body>

    <header>
        <h1>TMA-ERP</h1>
        <div id="user-info">
            <div class="user-details">
                <p>–†–æ–ª—å: <span id="role-display"></span></p>
                <p>–£—á–∞—Å—Ç–æ–∫: <span id="section-display"></span></p>
            </div>
            <button type="button" class="btn btn-logout btn-sm" onclick="logout()">–í—ã—Ö–æ–¥</button>
        </div>
    </header>

    <main>
        
        <!-- üîí –ê–í–¢–û–†–ò–ó–ê–¶–ò–Ø (–ü–ò–ù-–∫–æ–¥) -->
        <div id="pin-auth-panel" class="panel-section panel">
            <h2>üîë –í—Ö–æ–¥ –ø–æ PIN-–∫–æ–¥—É</h2>
            <p class="subtle-info main">–í–≤–µ–¥–∏—Ç–µ –≤–∞—à PIN-–∫–æ–¥ –¥–ª—è –ø—Ä–∏–≤—è–∑–∫–∏ Telegram ID.</p>
            
            <form id="pin-form">
                <div class="form-group">
                    <label for="pin-input">PIN-–∫–æ–¥ (4 —Ü–∏—Ñ—Ä—ã):</label>
                    <input type="password" id="pin-input" placeholder="****" required pattern="\d{4,4}" maxlength="4" inputmode="numeric">
                </div>
                
                <button type="submit" class="btn btn-primary" style="margin-top: 20px; width: 100%;">–í–æ–π—Ç–∏</button>
            </form>
            <div id="pin-message" class="alert" style="display:none; margin-top: 10px;"></div>
        </div>

        <!-- üëë –ì–õ–ê–í–ù–ê–Ø –ü–ê–ù–ï–õ–¨ –ê–î–ú–ò–ù–ò–°–¢–†–ê–¢–û–†–ê -->
        <div id="admin-panel" class="panel-section panel" style="display:none;">
            <h2 id="admin-title-display">üëë –ü–∞–Ω–µ–ª—å –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞</h2>
            <p class="subtle-info main">–í–∞—à Telegram ID: <span id="admin-tg-id-display"></span></p>

            <h3>‚öôÔ∏è –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ</h3>
            <div class="card-grid">
                <div class="card card-action" data-target="add-user-section">
                    <strong>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</strong>
                    <span class="subtle-info">–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ —Ä–æ–ª–µ–π –∏ PIN</span>
                </div>
                <div class="card card-action" data-target="add-section-panel">
                    <strong>–£—á–∞—Å—Ç–∫–∏</strong>
                    <span class="subtle-info">–î–æ–±–∞–≤–ª–µ–Ω–∏–µ/—É–¥–∞–ª–µ–Ω–∏–µ/—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ</span>
                </div>
                <div class="card card-action" data-target="add-pf-panel">
                    <strong>–¢–∏–ø—ã –ü–§</strong>
                    <span class="subtle-info">–ò–∑–¥–µ–ª–∏—è –∏ –ø–æ–ª—É—Ñ–∞–±—Ä–∏–∫–∞—Ç—ã</span>
                </div>
            </div>
            
            <h3>üìù –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥</h3>
            <div class="card-grid">
                <div class="card card-action card-success" data-target="create-request-section">
                    <strong>–°–æ–∑–¥–∞—Ç—å –ó–∞—è–≤–∫—É (–¢–µ—Å—Ç)</strong>
                    <span class="subtle-info">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–±–æ—á–∏–π —Ñ–ª–æ—É</span>
                </div>
                <div class="card card-action" data-target="stats-panel">
                    <strong>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</strong>
                    <span class="subtle-info">–ü—Ä–æ—Å–º–æ—Ç—Ä –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –∏ –æ—Ç—á–µ—Ç–æ–≤</span>
                </div>
            </div>
        </div>

        <!-- ‚ûï –°–ï–ö–¶–ò–Ø: –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–ò (–û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∫–∞—Ä—Ç–æ—á–∫–∞–º–∏) -->
        <div id="add-user-section" class="panel-section panel" style="display:none;">
            <h2>üë§ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏</h2>
            
            <h3>‚ûï –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤–æ–≥–æ</h3>
            <form id="add-user-form">
                <div class="form-group">
                    <label for="user-role">–†–æ–ª—å:</label>
                    <select id="user-role" required class="role-select">
                        <option value="master">–ú–∞—Å—Ç–µ—Ä</option>
                        <option value="otk">–û–¢–ö</option>
                        <option value="admin">–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä</option>
                        <option value="super_admin">–°—É–ø–µ—Ä –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="user-section">–£—á–∞—Å—Ç–æ–∫:</label>
                    <select id="user-section" class="section-select">
                        <!-- –û–ø—Ü–∏–∏ —É—á–∞—Å—Ç–∫–æ–≤ –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã —á–µ—Ä–µ–∑ JS -->
                    </select>
                    <p class="subtle-info">–ú–∞—Å—Ç–µ—Ä/–û–¢–ö –ø—Ä–∏–≤—è–∑—ã–≤–∞–µ—Ç—Å—è –∫ —É—á–∞—Å—Ç–∫—É.</p>
                </div>
                
                <div class="form-group">
                    <label for="user-pin-input">PIN-–∫–æ–¥ (4 —Ü–∏—Ñ—Ä—ã):</label>
                    <input type="text" id="user-pin-input" placeholder="–í–≤–µ–¥–∏—Ç–µ PIN –¥–ª—è –ø–µ—Ä–≤–æ–≥–æ –≤—Ö–æ–¥–∞" required pattern="\d{4,4}" maxlength="4" inputmode="numeric">
                </div>
                
                <button type="submit" class="btn btn-primary" style="width: 100%;">–î–æ–±–∞–≤–∏—Ç—å –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</button>
            </form>
            <div id="add-user-message" class="alert" style="display:none; margin-top: 10px;"></div>

            <h3>üìã –ê–∫—Ç–∏–≤–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</h3>
            <div id="users-card-list" class="card-list">
                <!-- –ö–∞—Ä—Ç–æ—á–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è —Å—é–¥–∞ -->
            </div>
        </div>

        <!-- ‚ûï –°–ï–ö–¶–ò–Ø: –£–ß–ê–°–¢–ö–ò (–û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∫–∞—Ä—Ç–æ—á–∫–∞–º–∏) -->
        <div id="add-section-panel" class="panel-section panel" style="display:none;">
            <h2>üè¢ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –£—á–∞—Å—Ç–∫–∞–º–∏</h2>
            
            <h3>‚ûï –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π —É—á–∞—Å—Ç–æ–∫</h3>
            <form id="add-section-form">
                <div class="form-group">
                    <label for="section-name-input">–ù–∞–∑–≤–∞–Ω–∏–µ —É—á–∞—Å—Ç–∫–∞:</label>
                    <input type="text" id="section-name-input" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –¶–µ—Ö 1.1, –°–±–æ—Ä–∫–∞" required>
                </div>
                <button type="submit" class="btn btn-primary" style="width: 100%;">–î–æ–±–∞–≤–∏—Ç—å –£—á–∞—Å—Ç–æ–∫</button>
            </form>
            <div id="add-section-message" class="alert" style="display:none; margin-top: 10px;"></div>

             <h3>üìã –°–ø–∏—Å–æ–∫ —É—á–∞—Å—Ç–∫–æ–≤</h3>
            <div id="sections-card-list" class="card-list">
                <!-- –ö–∞—Ä—Ç–æ—á–∫–∏ —É—á–∞—Å—Ç–∫–æ–≤ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è —Å—é–¥–∞ -->
            </div>
        </div>

        <!-- ‚úèÔ∏è –°–ï–ö–¶–ò–Ø: –†–ï–î–ê–ö–¢–ò–†–û–í–ê–ù–ò–ï –£–ß–ê–°–¢–ö–ê -->
        <div id="edit-section-panel" class="panel-section panel" style="display:none;">
            <h2>‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –£—á–∞—Å—Ç–æ–∫</h2>
            <form id="edit-section-form">
                <input type="hidden" id="edit-section-id">
                <div class="form-group">
                    <label for="edit-section-name">–ù–∞–∑–≤–∞–Ω–∏–µ —É—á–∞—Å—Ç–∫–∞:</label>
                    <input type="text" id="edit-section-name" required>
                </div>
                
                <div class="form-group">
                    <label for="edit-section-master">–ù–∞–∑–Ω–∞—á–∏—Ç—å –ú–∞—Å—Ç–µ—Ä–∞:</label>
                    <select id="edit-section-master" class="master-select">
                        <option value="">–ù–µ –Ω–∞–∑–Ω–∞—á–µ–Ω</option>
                        <!-- –î–æ—Å—Ç—É–ø–Ω—ã–µ –ú–∞—Å—Ç–µ—Ä–∞ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è —Å—é–¥–∞ -->
                    </select>
                    <p class="subtle-info">–í—ã–±–æ—Ä –ú–∞—Å—Ç–µ—Ä–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç–≤—è–∂–µ—Ç –µ–≥–æ –æ—Ç —Å—Ç–∞—Ä–æ–≥–æ —É—á–∞—Å—Ç–∫–∞ (–µ—Å–ª–∏ –±—ã–ª).</p>
                </div>

                <button type="submit" class="btn btn-primary" style="width: 100%;">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –ò–∑–º–µ–Ω–µ–Ω–∏—è</button>
            </form>
            <div id="edit-section-message" class="alert" style="display:none; margin-top: 10px;"></div>
        </div>
        
        <!-- ‚ûï –°–ï–ö–¶–ò–Ø: –î–û–ë–ê–í–ò–¢–¨ –ü–§ (–ó–ê–ì–õ–£–®–ö–ê) -->
        <div id="add-pf-panel" class="panel-section panel" style="display:none;">
            <h2>‚ûï –î–æ–±–∞–≤–∏—Ç—å –¢–∏–ø –ü–§ / –ò–∑–¥–µ–ª–∏—è (–ó–∞–≥–ª—É—à–∫–∞)</h2>
            <p>–≠—Ç–∞ –ø–∞–Ω–µ–ª—å –±—É–¥–µ—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å —Ñ–æ—Ä–º—É –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–æ–≤—ã—Ö —Ç–∏–ø–æ–≤ –ø–æ–ª—É—Ñ–∞–±—Ä–∏–∫–∞—Ç–æ–≤ –∏–ª–∏ –∏–∑–¥–µ–ª–∏–π.</p>
        </div>

        <!-- üìä –°–ï–ö–¶–ò–Ø: –°–¢–ê–¢–ò–°–¢–ò–ö–ê -->
        <div id="stats-panel" class="panel-section panel" style="display:none;">
            <h2>üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ó–∞—è–≤–æ–∫</h2>
            
            <div class="card-grid">
                <div class="card card-action">–í—Å–µ –∑–∞—è–≤–∫–∏</div>
                <div class="card card-action">–í —Ä–∞–±–æ—Ç–µ / –ù–∞ –ø—Ä–æ–≤–µ—Ä–∫–µ</div>
                <div class="card card-action">–ü—Ä–∏–Ω—è—Ç–æ —Å–µ–≥–æ–¥–Ω—è</div>
            </div>
            
            <div id="stats-results" style="margin-top: 20px;">
                –ó–∞–≥—Ä—É–∑–∫–∞...
            </div>
        </div>

        <!-- üìù –°–ï–ö–¶–ò–Ø: –°–û–ó–î–ê–ù–ò–ï –ó–ê–Ø–í–ö–ò (–ó–ê–ì–õ–£–®–ö–ê) -->
        <div id="create-request-section" class="panel-section panel" style="display:none;">
            <h2>üìù –°–æ–∑–¥–∞–Ω–∏–µ –ó–∞—è–≤–∫–∏ (–¢–µ—Å—Ç)</h2>
            <p>–≠—Ç–∞ –ø–∞–Ω–µ–ª—å –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –ú–∞—Å—Ç–µ—Ä–∞–º–∏ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞—è–≤–æ–∫.</p>
        </div>

        <!-- ‚öôÔ∏è –ì–õ–ê–í–ù–ê–Ø –ü–ê–ù–ï–õ–¨ –î–õ–Ø –ú–ê–°–¢–ï–†–ê/–û–¢–ö -->
        <div id="main-panel" class="panel-section panel" style="display:none;">
            <h2>üõ†Ô∏è –í–∞—à–∏ –ó–∞—è–≤–∫–∏</h2>
            <div id="requests-list">
                <!-- –°–ø–∏—Å–æ–∫ –∑–∞—è–≤–æ–∫ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –∑–¥–µ—Å—å -->
            </div>
            <p style="margin-top: 20px;">*–ó–¥–µ—Å—å –±—É–¥–µ—Ç –ª–æ–≥–∏–∫–∞ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∑–∞—è–≤–æ–∫, –¥–æ—Å—Ç—É–ø–Ω–∞—è –ú–∞—Å—Ç–µ—Ä—É/–û–¢–ö.</p>
        </div>

    </main>
    
    <!-- –§–ò–ö–°–ò–†–û–í–ê–ù–ù–ê–Ø –ö–ù–û–ü–ö–ê –ù–ê–ó–ê–î (–¢–æ–ª—å–∫–æ –¥–ª—è –ê–¥–º–∏–Ω–∫–∏) -->
    <div id="fixed-back-button" class="fixed-back-button" style="display: none;">
        <button type="button" class="btn btn-secondary" onclick="showPanel('admin-panel')">‚Üê –ù–∞–∑–∞–¥ –∫ –ø–∞–Ω–µ–ª–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è</button>
    </div>

    <footer>
        <p>–†–∞–∑—Ä–∞–±–æ—Ç–∞–Ω–æ –¥–ª—è TMA-ERP</p>
    </footer>
</body>
</html>