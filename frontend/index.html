<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TMA-ERP Production Manager</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>

    <header>
        <h1>TMA-ERP: –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ü—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–æ–º</h1>
        <div id="user-info" style="display:none;">
            <p>–†–æ–ª—å: <span id="role-display"></span> | –£—á–∞—Å—Ç–æ–∫: <span id="section-display"></span></p>
            <button type="button" class="btn btn-logout" onclick="logout()">–í—ã—Ö–æ–¥</button>
        </div>
    </header>

    <main>
        
        <div id="pin-auth-panel" class="panel-section">
            <h2>–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –ø–æ PIN-–∫–æ–¥—É</h2>
            <p>–í–≤–µ–¥–∏—Ç–µ –≤–∞—à PIN-–∫–æ–¥, —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å —Ä–∞–±–æ—Ç—É.</p>
            <form id="pin-form">
                <div class="form-group">
                    <label for="pin-input">PIN-–∫–æ–¥ (4-8 —Ü–∏—Ñ—Ä):</label>
                    <input type="password" id="pin-input" placeholder="****" required pattern="\d{4,8}">
                </div>
                <button type="submit" class="btn btn-primary">–í–æ–π—Ç–∏</button>
            </form>
            <div id="pin-message" class="alert" style="display:none; margin-top: 10px;"></div>
        </div>

        <div id="admin-panel" class="panel-section" style="display:none;">
            <h2>üëë –ì–ª–∞–≤–Ω–∞—è –ü–∞–Ω–µ–ª—å –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞</h2>
            <p>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, <span id="admin-tg-id-display">–ê–¥–º–∏–Ω</span>.</p>

            <h3>‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∏ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ</h3>
            <div class="section-choice-buttons">
                <button type="button" class="btn btn-primary" onclick="showPanel('add-user-section')">–î–æ–±–∞–≤–∏—Ç—å/–û–±–Ω–æ–≤–∏—Ç—å –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</button>
                <button type="button" class="btn btn-secondary" onclick="showPanel('add-section-panel')">–î–æ–±–∞–≤–∏—Ç—å –£—á–∞—Å—Ç–æ–∫</button>
                <button type="button" class="btn btn-secondary" onclick="showPanel('add-pf-panel')">–î–æ–±–∞–≤–∏—Ç—å –¢–∏–ø –ü–§ / –ò–∑–¥–µ–ª–∏—è</button>
            </div>
            
            <hr style="margin: 20px 0;">

            <h3>üìù –û–ø–µ—Ä–∞—Ü–∏–∏</h3>
            <div class="section-choice-buttons">
                <button type="button" class="btn btn-success" onclick="showPanel('create-request-section')">–°–æ–∑–¥–∞—Ç—å –ó–∞—è–≤–∫—É</button>
            </div>

            <hr style="margin: 20px 0;">
            
            <h3>üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏ –û—Ç—á–µ—Ç—ã</h3>
            <div class="section-choice-buttons">
                <button type="button" class="btn btn-info" onclick="showPanel('stats-panel')">–ü—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å –°—Ç–∞—Ç–∏—Å—Ç–∏–∫—É</button>
            </div>
            
        </div>

        <div id="add-user-section" class="panel-section" style="display:none;">
            <h2>‚ûï –î–æ–±–∞–≤–∏—Ç—å/–û–±–Ω–æ–≤–∏—Ç—å –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</h2>
            
            <form id="add-user-form">
                <div class="form-group">
                    <label for="admin-tg-id">Telegram ID:</label>
                    <input type="text" id="admin-tg-id" placeholder="ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–Ω–∞–ø—Ä–∏–º–µ—Ä: 123456789)" required pattern="\d+">
                </div>
                <div class="form-group">
                    <label for="admin-role">–†–æ–ª—å:</label>
                    <select id="admin-role" required>
                        <option value="master">–ú–∞—Å—Ç–µ—Ä</option>
                        <option value="otk">–û–¢–ö</option>
                        <option value="admin">–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="admin-section-select">–£—á–∞—Å—Ç–æ–∫:</label>
                    <select id="admin-section-select" required>
                        </select>
                </div>
                <div class="form-group">
                    <label for="admin-pin">PIN-–∫–æ–¥ (4-8 —Ü–∏—Ñ—Ä):</label>
                    <input type="text" id="admin-pin" placeholder="–£–Ω–∏–∫–∞–ª—å–Ω—ã–π PIN" required pattern="\d{4,8}">
                </div>
                <button type="submit" class="btn btn-primary">–î–æ–±–∞–≤–∏—Ç—å/–°–±—Ä–æ—Å–∏—Ç—å PIN</button>
            </form>
            <div id="admin-message" class="alert" style="display:none; margin-top: 10px;"></div>

            <button type="button" class="btn btn-secondary" style="margin-top: 15px;" onclick="showPanel('admin-panel')">‚Üê –ù–∞–∑–∞–¥ –∫ –ì–ª–∞–≤–Ω–æ–π –ü–∞–Ω–µ–ª–∏</button>
        </div>

        <div id="add-section-panel" class="panel-section" style="display:none;">
            <h2>‚ûï –î–æ–±–∞–≤–∏—Ç—å –£—á–∞—Å—Ç–æ–∫</h2>
            
            <form id="add-section-form">
                <div class="form-group">
                    <label for="section-name-input">–ù–∞–∑–≤–∞–Ω–∏–µ —É—á–∞—Å—Ç–∫–∞:</label>
                    <input type="text" id="section-name-input" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –¶–µ—Ö 1.1, –°–±–æ—Ä–∫–∞" required>
                </div>
                <button type="submit" class="btn btn-primary">–î–æ–±–∞–≤–∏—Ç—å –£—á–∞—Å—Ç–æ–∫</button>
            </form>
            <div id="add-section-message" class="alert" style="display:none; margin-top: 10px;"></div>

            <button type="button" class="btn btn-secondary" style="margin-top: 15px;" onclick="showPanel('admin-panel')">‚Üê –ù–∞–∑–∞–¥ –∫ –ì–ª–∞–≤–Ω–æ–π –ü–∞–Ω–µ–ª–∏</button>
        </div>

        <div id="add-pf-panel" class="panel-section" style="display:none;">
            <h2>‚ûï –î–æ–±–∞–≤–∏—Ç—å –¢–∏–ø –ü–§ / –ò–∑–¥–µ–ª–∏—è</h2>
            <p>–≠—Ç–∞ –ø–∞–Ω–µ–ª—å –±—É–¥–µ—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å —Ñ–æ—Ä–º—É –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–æ–≤—ã—Ö —Ç–∏–ø–æ–≤ –ø–æ–ª—É—Ñ–∞–±—Ä–∏–∫–∞—Ç–æ–≤ –∏–ª–∏ –∏–∑–¥–µ–ª–∏–π.</p>
            <button type="button" class="btn btn-secondary" onclick="showPanel('admin-panel')">‚Üê –ù–∞–∑–∞–¥ –∫ –ì–ª–∞–≤–Ω–æ–π –ü–∞–Ω–µ–ª–∏</button>
        </div>

        <div id="stats-panel" class="panel-section" style="display:none;">
            <h2>üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ó–∞—è–≤–æ–∫</h2>
            
            <div class="section-choice-buttons">
                <button type="button" class="btn btn-stats" onclick="loadStats('all')">–í—Å–µ –∑–∞—è–≤–∫–∏</button>
                <button type="button" class="btn btn-stats" onclick="loadStats('in_progress')">–í —Ä–∞–±–æ—Ç–µ / –ù–∞ –ø—Ä–æ–≤–µ—Ä–∫–µ</button>
                <button type="button" class="btn btn-stats" onclick="loadStats('accepted_today')">–ü—Ä–∏–Ω—è—Ç–æ —Å–µ–≥–æ–¥–Ω—è</button>
            </div>
            
            <div id="stats-results" style="margin-top: 20px;">
                –ó–∞–≥—Ä—É–∑–∫–∞...
            </div>

            <button type="button" class="btn btn-secondary" style="margin-top: 15px;" onclick="showPanel('admin-panel')">‚Üê –ù–∞–∑–∞–¥ –∫ –ì–ª–∞–≤–Ω–æ–π –ü–∞–Ω–µ–ª–∏</button>
        </div>

        <div id="create-request-section" class="panel-section" style="display:none;">
            <h2>üìù –°–æ–∑–¥–∞–Ω–∏–µ –ó–∞—è–≤–∫–∏</h2>
            
            <form id="request-form">
                <div class="form-group">
                    <label for="pf-select">–ü–æ–ª—É—Ñ–∞–±—Ä–∏–∫–∞—Ç (–ü–§):</label>
                    <select id="pf-select" required>
                        </select>
                </div>
                <div class="form-group">
                    <label for="quantity-input">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ:</label>
                    <input type="number" id="quantity-input" min="1" placeholder="–í–≤–µ–¥–∏—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ" required>
                </div>
                <div class="form-group">
                    <label for="comment-input">–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ):</label>
                    <textarea id="comment-input" rows="3" placeholder="–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –¥–µ—Ç–∞–ª–∏"></textarea>
                </div>
                <button type="submit" class="btn btn-success">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –ó–∞—è–≤–∫—É</button>
            </form>
            <div id="request-message" class="alert" style="display:none; margin-top: 10px;"></div>

            <button type="button" class="btn btn-secondary" style="margin-top: 15px;" onclick="goHome()">‚Üê –ù–∞ –≥–ª–∞–≤–Ω—É—é</button>
        </div>

        <div id="main-panel" class="panel-section" style="display:none;">
            <h2>üõ†Ô∏è –í–∞—à–∏ –ó–∞—è–≤–∫–∏</h2>
            <div id="requests-list">
                </div>
        </div>

    </main>

    <footer>
        <p>&copy; 2025 TMA-ERP | –†–∞–∑—Ä–∞–±–æ—Ç–∞–Ω–æ –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–∞</p>
    </footer>

    <script src="app.js"></script>
</body>
</html>